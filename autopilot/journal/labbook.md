# Autopilot Lab Book

> Append entries with `- YYYY-MM-DDTHH:MM:SSZ | action | observation | outcome | next`.

- 2025-09-20T23:30:27Z | train quick baseline | no grip; ho_pickup=0, perfect_* = 0; oob~0.95; sps~17k | patched env to target hidden_pos for hover then box_pos for descent; rebuilt bindings | rerun fresh; expect ho_pickup>0 and first grips
- 2025-09-20T23:30:55Z | run complete | Run 2025-09-20T232651Z (iteration 1) | metrics captured | 
- 2025-09-20T23:34:31Z | run complete | Run 2025-09-20T233055Z (iteration 2) | metrics captured | 
- 2025-09-20T23:45:00Z | revert env file | restored `drone_pp.h` to upstream commit 552502e (2025-09-20) | removed autopilot curriculum/gate relaxations; working tree clean for that file | update prompt to use notes as long‑term memory; plan fresh baseline
- 2025-09-20T23:55:00Z | refactor prompt | resolved no‑hparam contradictions; reorganized prompt per OVERVIEW/WORKFLOW/DECISIONS/CAN‑CHANGE/CANNOT‑CHANGE/TECHNICAL; added checklist, success metrics, failsafes | agent now treats Notes as long‑term memory and avoids hyperparameter edits | run fresh baseline to validate clarity
- 2025-09-21T00:03:00Z | prompt add history ref | updated prompt to explicitly consult Notes → “Header evolution: `drone_pp.h`” before edits | preserves historical intent; avoids re‑introducing removed patterns | proceed with fresh baseline under clarified guardrails
 - 2025-09-21T00:14:10Z | run baseline_full | launched `autopilot/scripts/run_training.sh` (EXACT_CONFIG=1) → run `2025-09-21T000458Z`; SPS ~1.69M, CPU ~330%; no behavioral_analysis emitted; summary metrics: success_rate 0.0, collision_rate ~0.005, episode_length ~146 | Observed high OOB (~0.86), near‑zero perfect_grip/deliv, minimal hover_pickup | prepare targeted env change (grip gates)
 - 2025-09-21T00:16:00Z | relax grip/hover gates | in `PufferLib/pufferlib/ocean/drone_pp/drone_pp.h`: lowered initial hover height (+0.8m), relaxed Phase‑1 hover gate (dist<0.6, speed<0.5), gentler descent (−0.08 m/s), relaxed Phase‑2 grip gates (xy/z<0.15·k, speed<0.15·k, vz>−0.08·k) | Hypothesis: increase hover_pickup and first‑grip attempts; expect slight uptick in grip_success with similar collision rate; OOB may remain elevated; next: adjust drop gates/soft‑wall if needed
- 2025-09-21T00:12:00Z | adopt box2 hparams | mirrored drone_pp.ini → baseline_full.json; added EXACT_CONFIG option in run script | local runs can use upstream hparams verbatim; device=mps for Mac | next: run with EXACT_CONFIG=1 to validate
- 2025-09-21T00:28:00Z | refactor notes.md | curated structure (baseline, learnings, evolution, hypotheses, decisions); pruned stale sections | clearer long‑term memory; concise guidance | maintain under 150 lines; update as upstream changes
- 2025-09-20T23:50:08Z | ignore overrides | Dropped keys ['autopilot.resume_mode', 'autopilot.save_strategy'] per no-hparam policy | using baselines | 
- 2025-09-21T00:25:09Z | run complete | Run 2025-09-21T000458Z (iteration 1) | metrics captured | 
 - 2025-09-21T00:28:09Z | run baseline_full | launched `autopilot/scripts/run_training.sh` → run `2025-09-21T002809Z`; SPS ~0.41–1.6M; CPU ~115–330%; device=mps | User Stats: perfect_grip=0.0, perfect_deliv=0.0, ho_pickup low→near‑zero by end, de_pickup≈0, to_drop=0; oob high (0.86→0.60), collision_rate ~0.005–0.009; episode_len ~143–415 | analyze and patch env to ease stable grip
 - 2025-09-21T00:39:45Z | relax grip descent + thresholds | `PufferLib/pufferlib/ocean/drone_pp/drone_pp.h`: lower initial hover (+0.6m from +0.8m), slower descent (−0.06 m/s from −0.08), relax Phase‑2 grip gates (xy/z/speed < 0.20·k; vz > −0.06·k < 0) | Hypothesis: gentler descent + wider gate increases first grips without spiking collisions; expect ho/de_pickup to rise and oob to fall modestly | rebuilt bindings; smoke‑import OK; stage next_config `{}`
- 2025-09-21T00:40:41Z | run complete | Run 2025-09-21T002809Z (iteration 1) | metrics captured | 
- 2025-09-21T00:40:41Z | run baseline_full | launched `autopilot/scripts/run_training.sh` (single-run) → run `2025-09-21T004041Z`; SPS ~0.43–1.6M; CPU ~125–335%; device=mps | User Stats snapshots: early oob~0.82, ho/de_pickup low; later oob~0.37, ho_pickup≈27k, de_pickup≈27k, to_drop=0, ho_drop≈189, perfect_grip>0 late; collision_rate≈0.018; episode_len≈140 | failure mode: improve_carrying (no approach to drop; drop hover gate misaligned; logging missing for to_drop)
- 2025-09-21T00:51:25Z | align drop approach + gentle descent | `PufferLib/pufferlib/ocean/drone_pp/drone_pp.h`: set `approaching_drop=true` when carrying; align drop hover z gate to 0.3–0.6m (target 0.4m); lower hidden drop hover to +0.6m; set drop descent to −0.06 m/s (from −0.10) | Hypothesis: increase `to_drop` and `ho_drop`, reduce OOB during carry/descent; expect first deliveries to register more reliably without raising collisions | rebuilt bindings; smoke‑import OK; staged next_config `{}` (no hparam changes)
 - 2025-09-21T02:56:54Z | run baseline_full | launched autopilot/scripts/run_training.sh → run 2025-09-21T025654Z; EXACT_CONFIG=1; device=mps | trainer_summary: success_rate 0.0, mean_reward 6.146, episode_len 137.789, collision_rate 0.0053, SPS ~1.74M; User Stats (final): perfect_grip=0.0, perfect_deliv=0.0, to_drop=0.0, ho_drop=0.0, oob~0.867 | failure mode: diagnostic_grip persists; summary.json absent (used train_full log fallback)
 - 2025-09-21T03:10:45Z | relax grip gates + attempt shaping | in `drone_pp.h` (PP2 pickup Phase‑2): xy/z gates 0.30→0.40·k; speed gate max(0.8, 0.40·k); vz gate −max(0.15,0.06·k)→−max(0.20,0.08·k); add small shaping bonus (reward_hover·0.25) for near‑miss attempts | Hypothesis: attempt_grip↑, ho/de_pickup↑, first non‑zero grips, to_drop>0 without raising collisions; OOB stable due to retained XY‑gated descent | rebuilt bindings; smoke‑import OK; staged next_config `{}` (no hparam changes)
- 2025-09-21T02:16:14Z | run baseline_full | launched `autopilot/scripts/run_training.sh` (single-run) → run `2025-09-21T021614Z`; device=mps; EXACT_CONFIG=1 | Summary: success_rate=0.0; mean_reward≈6.12; episode_length≈130.5; collision_rate≈0.005; SPS≈1.74M; agent_steps≈276.0M; oob≈0.874; perfect_grip=0.0; perfect_deliv=0.0; to_drop=0; ho_drop=0 | failure mode: fix_stability + diagnostic_grip (episodes end OOB near boundaries; no grips)
 - 2025-09-21T02:26:45Z | edge-aware spawn + tighter spawn radius | `PufferLib/pufferlib/ocean/drone_pp/drone_pp.h`: in `reset_pp2`, constrain box/drop XY spawn to ≥3.0m from walls; narrow drone spawn radius to 0.8–2.0m around box | Hypothesis: reduce OOB resets by avoiding edge spawns; increase `ho/de_pickup` by keeping starts near feasible hover corridors; collisions unchanged | rebuilt bindings; smoke‑import OK via venv; staged next_config `{}`; next: fresh run to validate OOB↓ and any grip attempts
- 2025-09-21T00:52:15Z | run complete | Run 2025-09-21T004041Z (iteration 2) | metrics captured | 
 - 2025-09-21T00:52:15Z | run baseline_full | launched `autopilot/scripts/run_training.sh` → run `2025-09-21T005215Z`; SPS ~1.68M; CPU ~330%; device=mps | User Stats (final pane): perfect_grip=0.0, perfect_deliv=0.0, ho_pickup≈0.03, de_pickup≈0.03, to_drop=0.0, ho_drop=0.0; oob≈0.876; collision_rate≈0.005; episode_len≈128 | failure mode: diagnostic_grip with high OOB; hover/grip attempts too rare
 - 2025-09-21T01:03:20Z | spawn near box | `PufferLib/pufferlib/ocean/drone_pp/drone_pp.h`: in `reset_pp2`, spawn drone within 1.0–2.5m radius and 1.5–2.5m above its box; clamp to grid; zero initial vel/omega | Hypothesis: reduce early OOB and convert more approaches to hover/grip; expect `to_pickup↑`, `ho_pickup↑`, first non‑zero grips while keeping collisions low | rebuilt bindings; smoke‑import OK; staged next_config `{}` (no hparam changes)
- 2025-09-21T01:03:47Z | run complete | Run 2025-09-21T005215Z (iteration 3) | metrics captured | 
 - 2025-09-21T01:12:36Z | run baseline_full | launched autopilot/scripts/run_training.sh → run 2025-09-21T010347Z; SPS ~1.7M; CPU ~330%; device=mps | User Stats: perfect_grip=0.0, perfect_deliv=0.0; ho_pickup present but low; to_drop=0; oob≈0.80; collision_rate≈0.005; episode_len≈128 | failure: diagnostic_grip with high OOB near floor; patch env to raise pickup hover/spawn altitude
 - 2025-09-21T01:15:00Z | raise pickup hover + spawn z | in PufferLib/pufferlib/ocean/drone_pp/drone_pp.h: hidden_pos.z += 0.9 (from +0.6); spawn z above box 2.0–3.0m (from 1.5–2.5m); rebuild bindings; smoke‑import OK | Hypothesis: reduce floor‑induced OOB, increase stable hover attempts; expect oob↓ and ho/de_pickup↑ without affecting collisions; deliveries may remain 0 until grips register | staged next_config {} (no hparam changes)
- 2025-09-21T01:15:40Z | run complete | Run 2025-09-21T010347Z (iteration 4) | metrics captured | 
 - 2025-09-21T01:15:40Z | run baseline_full | launched autopilot/scripts/run_training.sh → run 2025-09-21T011540Z; device=mps; EXACT_CONFIG=1 | User Stats (final): oob≈0.858, collision_rate≈0.005, perfect_grip=0.0, perfect_deliv=0.0, ho_pickup≈0.073, de_pickup≈0.073, to_drop=0.0, ho_drop=0.0; SPS≈1.7M; CPU≈332% | failure: diagnostic_grip with high OOB; agents descend while laterally misaligned and clip floor
 - 2025-09-21T01:26:20Z | gate descent on XY alignment; add attempts | in PufferLib/pufferlib/ocean/drone_pp/drone_pp.h: only descend in pickup/drop when xy_dist <= 0.20·max(k,1); otherwise hold altitude; add env->log.attempt_grip/attempt_drop near‑miss counters; export in binding | Hypothesis: reduce OOB by preventing drift‑descent; convert more hovers into stable grips; expect oob↓, ho/de_pickup↑, first non‑zero gripping; deliveries may remain 0 until grips improve | staged next_config {} (no hparam changes); rebuilt bindings
- 2025-09-21T01:27:09Z | run complete | Run 2025-09-21T011540Z (iteration 5) | metrics captured | 
2025-09-21T012845Z — Run + env tweak: relax pickup hover gate

- Action: Launched autopilot/scripts/run_training.sh (single run, EXACT_CONFIG=1). Analyzed trainer_summary and train.log.
- Observations:
  - SPS ≈ 1.7M; CPU ≈ 330%; GPU 0%.
  - oob ≈ 0.87 (high), collision_rate ≈ 0.005.
  - ho_pickup ≈ 0.007; de_pickup ≈ 0.007; perfect_grip = 0; perfect_deliv = 0; to_drop = 0; ho_drop = 0.
  - Failure mode: diagnostic_grip — agents rarely meet the pickup hover gate, so descent/grip almost never occur; OOB remains high.
- Change (for next iteration): In PufferLib/pufferlib/ocean/drone_pp/drone_pp.h, relax the Phase 1 pickup hover gate from dist_to_hidden < 0.6 and speed < 0.5 to dist_to_hidden < 1.0 and speed < 0.8. Descent remains guarded by XY-alignment and gentle descent rate (−0.06 m/s).
- Hypothesis: Earlier admission into “hovering_pickup” enables descent attempts; expect ho/de_pickup↑, attempt_grip↑, modest oob↓; eventual non‑zero gripping under k≈1.
- Next: Keep proposals as {} (no hparam changes). Resume fresh next run; reassess attempt_grip, ho/de_pickup, and oob trends.
- 2025-09-21T01:39:52Z | run complete | Run 2025-09-21T012845Z (iteration 1) | metrics captured | 
2025-09-21T01:48:27Z — Run 2025-09-21T013952Z (single run, EXACT_CONFIG=1)

- Action: Launched autopilot/scripts/run_training.sh (full profile). Read trainer_summary.json and tail of train log.
- Observations:
  - SPS ≈ 1.57M; CPU ≈ 340%; GPU 0%.
  - success_rate = 0.0; collision_rate ≈ 0.0056; episode_length ≈ 150.2.
  - User Stats (final): oob ≈ 0.855; ho_pickup ≈ 0.002; de_pickup ≈ 0.002; perfect_grip = 0; perfect_deliv = 0; to_drop = 0; ho_drop = 0.
  - Failure mode: diagnostic_grip with high OOB — agents rarely satisfy pickup hover gate; grips/deliveries remain zero.
- Change (for next iteration):
  - PufferLib/pufferlib/ocean/drone_pp/drone_pp.h: use hidden hover point for the generic “to target” observation in PP2 (align obs with phase logic); relax pickup hover gate (dist_to_hidden < 1.8, speed < 1.2) while keeping XY‑gated descent and gentle −0.06 m/s.
  - Rebuilt native bindings; smoke‑import OK.
- Hypothesis: Better guidance toward hover point increases ho/de_pickup and attempt_grip without raising collisions; OOB should drop modestly by reducing drift‑descent.
- Next: Keep next_config `{}` (no hyperparameter edits). Monitor ho/de_pickup, attempt_grip, oob, and first non‑zero grips next run.
- 2025-09-21T01:52:24Z | run complete | Run 2025-09-21T013952Z (iteration 2) | metrics captured | 
- 2025-09-21T02:01:30Z | run baseline_full | launched `autopilot/scripts/run_training.sh` (single-run, EXACT_CONFIG=1) → run `20250921T015306Z`; device=mps; vec 24/24; env 24×64 | SPS≈1.70M; CPU≈333% | User Stats (final): oob≈0.835, collision_rate≈0.0058, episode_len≈170; perfect_grip=0.0, perfect_deliv=0.0; ho_pickup≈0.136, de_pickup≈0.135; to_drop=0.0, ho_drop=0.0 | failure mode: diagnostic_grip (no grips; approach/descent present but vertical speed gate likely too strict at k≈1)
- 2025-09-21T02:04:10Z | relax grip vz gate | `PufferLib/pufferlib/ocean/drone_pp/drone_pp.h`: in pickup Phase‑2, loosen vertical descent gate from `vel.z > -0.06·k` to `vel.z > -max(0.15, 0.06·k)`; rationale: with k near 1.0, the −0.06 m/s cap blocks reasonable descent → no grips | Hypothesis: increase first‑grip registrations and unlock carry→drop path without raising collisions; expect ho/de_pickup↑, attempt_grip↑, non‑zero `to_drop` next run | Rebuilt bindings; smoke‑import OK; staged next_config `{}` (no hparam changes)
- 2025-09-21T02:04:21Z | run complete | Run 2025-09-21T015224Z (iteration 3) | metrics captured | 
- 2025-09-21T02:04:21Z | run baseline_full | launched `autopilot/scripts/run_training.sh` (≥15m timeout, EXACT_CONFIG=1) → run `2025-09-21T020421Z`; device=mps; vec 24/24; env 24×64 | SPS≈1.66–1.70M; CPU≈340% | User Stats (final): perfect_grip=0.0, perfect_deliv=0.0; ho_pickup≈0.062; de_pickup≈0.062; to_drop=0.0; ho_drop=0.0; oob≈0.857; collision_rate≈0.0055; episode_len≈148 | failure mode: diagnostic_grip (grip attempts too rare; high OOB)

- 2025-09-21T02:37:23Z | run baseline_full | launched `autopilot/scripts/run_training.sh` (single-run, EXACT_CONFIG=1) → run `2025-09-21T022758Z`; device=mps | User Stats (final): perfect_grip=0.0; perfect_deliv=0.0; ho_pickup≈0.016–0.021; de_pickup≈0.015–0.021; to_drop=0.0; ho_drop=0.0; oob≈0.872; collision_rate≈0.0053; episode_len≈133 | failure mode: diagnostic_grip with high OOB (hover gate too strict in practice)
- 2025-09-21T02:39:20Z | relax pickup hover (XY fallback) | `PufferLib/pufferlib/ocean/drone_pp/drone_pp.h`: in Phase‑1 pickup, allow hover when `xy_dist <= 0.50·max(k,1)`, `z_above_box > 0.4m`, `speed < 2.0m/s` (fallback to hidden‑point gate remains). Descent still XY‑gated (≤0.30·max(k,1)) and gentle (−0.06 m/s). | Hypothesis: ho/de_pickup↑ and first grips; OOB↓ modestly; collisions ~flat. Rebuilt bindings; smoke‑import OK. Next: {}
 - 2025-09-21T02:14:40Z | relax XY alignment + widen grip gates | `PufferLib/pufferlib/ocean/drone_pp/drone_pp.h`: relax XY alignment threshold for descent (0.20→0.30·max(k,1)); widen Phase‑2 grip gates (xy/z/speed < 0.30·k; keep vz > −max(0.15, 0.06·k) < 0) | Hypothesis: ho/de_pickup↑, attempt_grip↑; first non‑zero grips; OOB↓ modestly without raising collisions | Rebuilt bindings; smoke‑import OK; staged next_config `{}` (no hparam edits)
- 2025-09-21T02:16:14Z | run complete | Run 2025-09-21T020421Z (iteration 4) | metrics captured | 
- 2025-09-21T02:27:58Z | run complete | Run 2025-09-21T021614Z (iteration 5) | metrics captured | 
- 2025-09-21T02:40:25Z | run complete | Run 2025-09-21T022758Z (iteration 6) | metrics captured | 
- 2025-09-21T02:40:25Z | run baseline_full | launched `autopilot/scripts/run_training.sh` (single-run, EXACT_CONFIG=1) → run `2025-09-21T024025Z`; device=mps; vec 24/24; env 24×64 | SPS≈0.43–1.60M; CPU≈140–346% | User Stats (final): perfect_grip=0.0, perfect_deliv=0.0; ho_pickup≈0.069; de_pickup≈0.068; to_drop=0.0; ho_drop=0.0; oob≈0.865; collision_rate≈0.0053; episode_len≈140 | failure mode: diagnostic_grip with high OOB — agents fail to stabilize over box; no grips
- 2025-09-21T02:51:30Z | align reward to hover | `PufferLib/pufferlib/ocean/drone_pp/drone_pp.h` (PP2 pickup): set `agent->target_pos = agent->hidden_pos` during Phase‑1 hover and Phase‑2 descent so compute_reward shapes toward the hidden hover waypoint (which descends gently once XY‑aligned) | Hypothesis: better stabilization above box and controlled descent → ho/de_pickup↑, attempt_grip↑, OOB↓; first non‑zero grips possible without raising collisions | Rebuilt bindings (`NO_TRAIN=1 python3 setup.py build_ext --inplace --force`); smoke‑import OK | Next: `{}`
- 2025-09-21T02:52:51Z | run complete | Run 2025-09-21T024025Z (iteration 7) | metrics captured | 
- 2025-09-21T03:09:44Z | run complete | Run 2025-09-21T025654Z (iteration 1) | metrics captured | 

- 2025-09-21T03:18:26Z | run baseline_full | Run 2025-09-21T030944Z; perfect_grip=0, perfect_deliv=0; ho/de_pickup low; to_drop=0; oob≈0.85; coll≈0.005–0.009; ep_len≈136–404; SPS≈1.65M | bump reward shaping (w_approach→3.0, w_hover→2.0, reward_hover→0.35) to encourage XY alignment and hover before descent; no gate changes; no rebuild | next: {}
- 2025-09-21T03:22:05Z | run complete | Run 2025-09-21T030944Z (iteration 2) | metrics captured | 
